# SQL 튜닝

참고로 SQL이 병목 혹은 지연 없이 빠르고 안전하게 수행하도록 하는 방법은 SQL튜닝만 있는 것이 아니다. 

- DB(데이터 구조)를 어떻게 설계하느냐 혹은 
- 프로세스/메모리 설정을 어떻게 하느냐

와 같은 SQL튜닝 외적인 팩터들이 SQL수행에 끼치는 영향이 적지 않다. 하지만 이번에는 SQL튜닝에만 포커스해서 내용을 살펴보고자 한다.



SQL튜닝은 크게 

1. 어떤 조인 방식을 선택하는가

   : Nested Loop 조인, Hash 조인, Sort Merge 조인, Subquery 조인 을 어떤 기준으로 선택할 것인가 

2. where절 오더링을 어떻게 하는가

3. 어떤 스캔 방식을 선택하는가

   : Full table scan, index scan 을 어떤 기준으로 선택할 것인가

로 목차를 세울 수 있다.



### 들어가기 전에

하지만 이것을 들어가기 전에, SQL 옵티마이저를 알고 있어야한다. 사용자가 SQL을 날리면 가장 먼저 **SQL파서**가 파싱을 해서 트리를 만들어 놓는다. 그러면 **옵티마이저**는 수집된 정보로 가장 최적의 실행 경로를 생성하는데, 이 부분이 최적화의 핵심이다. 그러면 **로우 소스 생성기** 가 프로시저로 포맷팅해서 실행 가능하게 만든다.

옵티마이저를 조금 더 들어가서 살펴보면,

1. 사용자의 쿼리를 수행할 실행 계획을 찾아낸다. 

   (가령, 조인은 NL로 할지 Hash로 할지, 인덱스는 어떤 인덱스를 탈지 등에 따라 경우의 수가 많을 것이다.)

   (어떤 것을 선택할지를 정해줄 수가 있는데, 이것이 **힌트** 이다. => 이건 나중에)

2. 각 실행 계획의 예상 비용을 계산하고, 최저 비용의 실행 계획을 선택한다.

   (참고로 **라이브러리 캐시** 라는 메모리 공간이 있는데, 쿼리에 대한 최저 비용 실행 계획이 담겨 있다. 그래서 재사용이 가능하다.)

   (또 **비하인드 변수** 라는 파라미터가 있는데, 이는 where 절에 ? 에 해당하는 값만 바뀌는 경우 실행 계획은 똑같기 때문에 재사용을 높인다.)

















